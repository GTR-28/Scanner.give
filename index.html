<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Search</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
:root {
--primary: #FF4500; /* Reddit orange */
--primary-hover: #e03d00;
--secondary: #1DA1F2; /* Twitter blue */
--secondary-hover: #0d8fd9;
--tertiary: #4267B2; /* Facebook blue */
--tertiary-hover: #365899;
--background: #f5f5f5;
--card-bg: #ffffff;
--text: #1c1c1c;
--text-secondary: #7c7c7c;
--border: #edeff1;
--toast-bg: #1f2937;
--toast-text: #ffffff;
--vote-up: #FF4500;
--vote-down: #7193FF;
}

.dark {
--primary: #FF4500;
--primary-hover: #e03d00;
--secondary: #1DA1F2;
--secondary-hover: #0d8fd9;
--tertiary: #4267B2;
--tertiary-hover: #365899;
--background: #121212;
--card-bg: #1A1A1B;
--text: #D7DADC;
--text-secondary: #818384;
--border: #343536;
--toast-bg: #D7DADC;
--toast-text: #1A1A1B;
}

body {
background-color: var(--background);
color: var(--text);
font-family: 'IBM Plex Sans', 'Noto Sans', 'Roboto', sans-serif;
}

.post-card {
padding: 1rem;
transition: background-color 0.2s;
border: 1px solid var(--border);
margin-bottom: 0.5rem;
}

.post-card:hover {
border-color: var(--primary);
}

.app-header {
background-color: var(--card-bg);
border-bottom: 1px solid var(--border);
}

.reddit-button {
background-color: var(--primary);
color: white;
font-weight: bold;
border-radius: 9999px;
}

.reddit-button:hover {
background-color: var(--primary-hover);
}

.platform-tab {
cursor: pointer;
transition: all 0.2s;
border-bottom: 2px solid transparent;
padding: 0.5rem 1rem;
}

.platform-tab.active {
border-bottom-color: var(--primary);
font-weight: bold;
}

.platform-tab:hover:not(.active) {
border-bottom-color: var(--border);
}

/* Animation styles */
@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.5; }
}

.pulse {
animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeOut {
from { opacity: 1; transform: translateY(0); }
to { opacity: 0; transform: translateY(20px); }
}

.fadeIn { animation: fadeIn 0.3s ease forwards; }
.fadeOut { animation: fadeOut 0.3s ease forwards; }

.chip {
cursor: pointer;
transition: all 0.2s;
border: 1px solid var(--border);
}

.chip:hover {
background-color: var(--primary);
color: white;
}

/* Platform specific colors */
.platform-reddit {
--platform-color: var(--primary);
--platform-hover: var(--primary-hover);
}

.platform-twitter {
--platform-color: var(--secondary);
--platform-hover: var(--secondary-hover);
}

.platform-facebook {
--platform-color: var(--tertiary);
--platform-hover: var(--tertiary-hover);
}
</style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
<!-- App header -->
<header class="app-header sticky top-0 z-10 px-4 py-2">
<div class="container mx-auto flex items-center justify-between">
<div class="flex items-center">
<svg class="h-8 w-8 text-primary fill-current" viewBox="0 0 20 20">
<path d="M10 0C4.478 0 0 4.478 0 10c0 5.523 4.478 10 10 10 5.523 0 10-4.477 10-10 0-5.522-4.477-10-10-10zm5.7 11.25c.06.218.081.44.061.661-.06.661-.366 1.235-.846 1.637-.48.4-1.145.622-1.827.622-.737 0-1.416-.246-1.956-.661-.54.415-1.22.661-1.956.661-.682 0-1.347-.222-1.827-.622-.48-.402-.786-.976-.846-1.637-.02-.22 0-.443.061-.661-.53-.354-.847-.942-.847-1.573 0-.698.347-1.309.878-1.677.53-.369 1.225-.502 1.877-.332.654-.894 1.615-1.464 2.66-1.464s2.006.57 2.66 1.464c.652-.17 1.347-.037 1.877.332.53.368.878.979.878 1.677 0 .631-.318 1.219-.847 1.573zM7.35 9.05c-.542 0-.983.441-.983.984 0 .542.44.983.983.983.541 0 .982-.44.982-.983 0-.543-.44-.984-.982-.984zm5.3 0c-.542 0-.983.441-.983.984 0 .542.44.983.983.983.541 0 .982-.44.982-.983 0-.543-.44-.984-.982-.984z"></path>
</svg>
<h1 class="ml-2 text-xl font-bold text-primary">Social Search</h1>
</div>
<button id="theme-toggle" class="p-2 rounded-full">
<svg id="theme-toggle-dark-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
</svg>
<svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
<path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
</svg>
</button>
</div>
</header>

<!-- Platform tabs -->
<div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
<div class="container mx-auto px-4">
<div class="flex overflow-x-auto">
<div class="platform-tab platform-reddit active" data-platform="reddit">
<div class="flex items-center">
<svg class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
<path d="M10 0C4.478 0 0 4.478 0 10c0 5.523 4.478 10 10 10 5.523 0 10-4.477 10-10 0-5.522-4.477-10-10-10zm5.7 11.25c.06.218.081.44.061.661-.06.661-.366 1.235-.846 1.637-.48.4-1.145.622-1.827.622-.737 0-1.416-.246-1.956-.661-.54.415-1.22.661-1.956.661-.682 0-1.347-.222-1.827-.622-.48-.402-.786-.976-.846-1.637-.02-.22 0-.443.061-.661-.53-.354-.847-.942-.847-1.573 0-.698.347-1.309.878-1.677.53-.369 1.225-.502 1.877-.332.654-.894 1.615-1.464 2.66-1.464s2.006.57 2.66 1.464c.652-.17 1.347-.037 1.877.332.53.368.878.979.878 1.677 0 .631-.318 1.219-.847 1.573zM7.35 9.05c-.542 0-.983.441-.983.984 0 .542.44.983.983.983.541 0 .982-.44.982-.983 0-.543-.44-.984-.982-.984zm5.3 0c-.542 0-.983.441-.983.984 0 .542.44.983.983.983.541 0 .982-.44.982-.983 0-.543-.44-.984-.982-.984z"></path>
</svg>
Reddit
</div>
</div>
<div class="platform-tab platform-twitter" data-platform="twitter">
<div class="flex items-center">
<svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
<path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
</svg>
Twitter
<span class="ml-1 text-xs text-gray-500">(Coming soon)</span>
</div>
</div>
<div class="platform-tab platform-facebook" data-platform="facebook">
<div class="flex items-center">
<svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="currentColor">
<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
</svg>
Facebook
<span class="ml-1 text-xs text-gray-500">(Coming soon)</span>
</div>
</div>
</div>
</div>
</div>

<div class="container mx-auto px-4 py-6">
<main class="grid grid-cols-1 md:grid-cols-3 gap-6">
<!-- Left column - Settings & Recommended Sources -->
<div class="md:col-span-1">
<!-- Settings Card -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
<h2 class="text-xl font-semibold mb-4">Monitor Settings</h2>
<div class="mb-4">
<label class="block text-sm font-medium mb-1" for="subreddit">Subreddit</label>
<input type="text" id="subreddit" value="Soundmap"
class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1" for="flair">Filter by Flair</label>
<input type="text" id="flair" value="N/A"
class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1" for="checkInterval">Check Interval</label>
<select id="checkInterval"
class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
<option value="1">1 minute</option>
<option value="5" selected>5 minutes</option>
<option value="10">10 minutes</option>
<option value="15">15 minutes</option>
<option value="30">30 minutes</option>
<option value="60">1 hour</option>
</select>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1" for="ntfyTopic">Ntfy.sh Topic</label>
<input type="text" id="ntfyTopic" value="redditmonitor"
class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
</div>
<div class="flex items-center mb-4">
<input type="checkbox" id="notifications" class="h-4 w-4 text-primary" checked>
<label for="notifications" class="ml-2 block text-sm">Enable Notifications</label>
</div>
<div class="flex justify-between items-center">
<span id="next-check" class="text-sm text-gray-600 dark:text-gray-400">Next check in: 5:00</span>
<div class="flex space-x-2">
<button id="save-settings" class="px-4 py-2 reddit-button">
Save Settings
</button>
<button id="check-now" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded">
Check Now
</button>
</div>
</div>
</div>

<!-- Recommended Sources Card -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6" id="recommended-sources">
<h2 class="text-xl font-semibold mb-4">Popular Subreddits</h2>
<div class="flex flex-wrap gap-2">
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="AskReddit">r/AskReddit</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="mildlyinfuriating">r/mildlyinfuriating</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="worldnews">r/worldnews</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="funny">r/funny</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="gaming">r/gaming</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="pics">r/pics</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="news">r/news</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="aww">r/aww</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="movies">r/movies</span>
<span class="chip px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm" data-source="explainlikeimfive">r/explainlikeimfive</span>
</div>
</div>

<!-- Notification Setup Card -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
<div class="flex items-center mb-4">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary" viewBox="0 0 20 20" fill="currentColor">
<path fill-rule="evenodd" d="M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 14a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
</svg>
<h3 class="text-xl font-semibold">Mobile Notifications</h3>
</div>
<p class="mb-4 text-gray-600 dark:text-gray-400">
Get alerts on your phone using ntfy.sh
</p>

<div class="space-y-4">
<div>
<h4 class="font-medium mb-2">1. Download ntfy app</h4>
<div class="flex space-x-2 mb-4">
<a href="https://play.google.com/store/apps/details?id=io.heckel.ntfy" target="_blank" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 text-sm rounded flex items-center">
<svg class="h-5 w-5 mr-1" fill="currentColor" viewBox="0 0 24 24">
<path d="M17.523 15.334c-.47.322-1.175.798-2.011 1.394-2.699 1.928-5.777 4.542-5.88 4.643a3.047 3.047 0 0 1-1.139.752c-.059.021-.119.04-.179.058V4.101c.059.018.119.037.179.058.41.14.798.361 1.139.752.103.101 3.172 2.704 5.88 4.643.846.605 1.553 1.082 2.011 1.394.459.313.57.573.6.728L18 12c0 .155-.53.415-.477.728"></path>
</svg>
Android
</a>
<a href="https://apps.apple.com/us/app/ntfy/id1625396347" target="_blank" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 text-sm rounded flex items-center">
<svg class="h-5 w-5 mr-1" fill="currentColor" viewBox="0 0 24 24">
<path d="M14.94 5.19A4.38 4.38 0 0 0 16 2a4.44 4.44 0 0 0-3 1.52 4.17 4.17 0 0 0-1 3.09 3.69 3.69 0 0 0 2.94-1.42zm2.52 7.44A4.51 4.51 0 0 1 19 16.5a11.11 11.11 0 0 1-1.62 3.25c-1.08 1.56-2.19 3.25-3.82 3.25s-2.12-1.31-4.12-1.31c-1.87 0-2.5 1.35-4.06 1.35S2.06 20.94 1 19.34a11.19 11.19 0 0 1 5.06-9.5 5.35 5.35 0 0 1 4.44 0A4.71 4.71 0 0 0 12.54 9a4.43 4.43 0 0 0 2.6-1.25A4.2 4.2 0 0 1 18 10.75a4 4 0 0 1-1.54 1.88"></path>
</svg>
iOS
</a>
</div>
</div>

<div>
<h4 class="font-medium mb-2">2. Subscribe to the topic</h4>
<div class="flex space-x-2 mb-4">
<div class="flex-1 bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded font-mono text-sm">
<span id="topic-display">redditmonitor</span>
</div>
<button id="copy-topic" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
</button>
</div>
</div>
</div>

<a href="https://ntfy.sh/redditmonitor" target="_blank" id="ntfy-link" class="inline-flex items-center px-4 py-2 reddit-button mt-2">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
</svg>
Open ntfy.sh Web Interface
</a>
</div>
</div>

<!-- Right column - Post Feed -->
<div class="md:col-span-2">
<!-- Posts Card -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-semibold">Recent Posts</h2>
<button id="check-now-feed" class="px-4 py-2 reddit-button text-sm">
Check Now
</button>
</div>

<div id="posts-container" class="divide-y divide-gray-200 dark:divide-gray-700">
<!-- Posts will be loaded here -->
<div class="text-center py-10" id="empty-state">
<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
</svg>
<h3 class="text-lg font-medium">No posts yet</h3>
<p class="text-gray-500 dark:text-gray-400 mt-1">
Content from your selected platforms will appear here
</p>
</div>
</div>

<!-- Show More Button (initially hidden) -->
<div id="show-more-container" class="mt-4 text-center hidden">
<button id="show-more-posts" class="px-4 py-2 text-primary hover:underline">
Show More Posts
</button>
</div>
</div>
</div>
</main>

<footer class="mt-8 text-center text-gray-600 dark:text-gray-400 text-sm">
<p>
Social Search - Monitor your favorite social media platforms for specific content
</p>
</footer>
</div>

<div id="toast" class="fixed right-4 bottom-4 z-50 opacity-0 transition-opacity duration-300 hidden">
<div class="bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg">
<span id="toast-message">Message here</span>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
// DOM elements
const subredditInput = document.getElementById('subreddit');
const flairInput = document.getElementById('flair');
const checkIntervalSelect = document.getElementById('checkInterval');
const ntfyTopicInput = document.getElementById('ntfyTopic');
const notificationsCheckbox = document.getElementById('notifications');
const saveSettingsBtn = document.getElementById('save-settings');
const checkNowBtn = document.getElementById('check-now');
const checkNowFeedBtn = document.getElementById('check-now-feed');
const nextCheckSpan = document.getElementById('next-check');
const postsContainer = document.getElementById('posts-container');
const emptyState = document.getElementById('empty-state');
const topicDisplay = document.getElementById('topic-display');
const copyTopicBtn = document.getElementById('copy-topic');
const themeToggleBtn = document.getElementById('theme-toggle');
const darkIcon = document.getElementById('theme-toggle-dark-icon');
const lightIcon = document.getElementById('theme-toggle-light-icon');
const chips = document.querySelectorAll('.chip');
const showMoreContainer = document.getElementById('show-more-container');
const showMoreBtn = document.getElementById('show-more-posts');
const platformTabs = document.querySelectorAll('.platform-tab');
const ntfyLink = document.getElementById('ntfy-link');
const recommendedSources = document.getElementById('recommended-sources');

// Settings
const defaultSettings = {
platform: 'reddit',
subreddit: 'Soundmap',
flair: 'N/A',
checkInterval: 5,
ntfyTopic: 'socialsearch',
notifications: true
};

let settings = loadSettings();
let timer = null;
let nextCheckTime = new Date();
nextCheckTime.setMinutes(nextCheckTime.getMinutes() + settings.checkInterval);
let allPosts = []; // Store all posts
let visiblePostCount = 10; // Initial number of posts to show
let currentPlatform = settings.platform || 'reddit';

// Initialize UI
initializeUI();
startTimer();
checkForPosts();
initializeTheme();
updatePlatformUI(currentPlatform);

// Event listeners
saveSettingsBtn.addEventListener('click', saveSettings);
checkNowBtn.addEventListener('click', checkForPosts);
checkNowFeedBtn.addEventListener('click', checkForPosts);
copyTopicBtn.addEventListener('click', copyTopic);
themeToggleBtn.addEventListener('click', toggleTheme);
showMoreBtn.addEventListener('click', showMorePosts);

// Add event listeners to chips
chips.forEach(chip => {
chip.addEventListener('click', () => {
subredditInput.value = chip.dataset.source;
saveSettings();
});
});

// Add event listeners to platform tabs
platformTabs.forEach(tab => {
tab.addEventListener('click', () => {
if (tab.classList.contains('active') || tab.querySelector('span')) {
return; // Skip if already active or has "coming soon" tag
}

const platform = tab.dataset.platform;
currentPlatform = platform;

// Update active tab
platformTabs.forEach(t => t.classList.remove('active'));
tab.classList.add('active');

// Update UI for the selected platform
updatePlatformUI(platform);

// Update settings
settings.platform = platform;
localStorage.setItem('socialSearchSettings', JSON.stringify(settings));

// Clear posts when changing platforms
clearPosts();
});
});

// Functions
function initializeUI() {
subredditInput.value = settings.subreddit;
flairInput.value = settings.flair;
checkIntervalSelect.value = settings.checkInterval;
ntfyTopicInput.value = settings.ntfyTopic;
notificationsCheckbox.checked = settings.notifications;
topicDisplay.textContent = settings.ntfyTopic;
ntfyLink.href = `https://ntfy.sh/${settings.ntfyTopic}`;
}

function loadSettings() {
const savedSettings = localStorage.getItem('socialSearchSettings');
return savedSettings ? JSON.parse(savedSettings) : defaultSettings;
}

function saveSettings() {
const oldSettings = {...settings};

settings = {
...settings,
subreddit: subredditInput.value.trim(),
flair: flairInput.value.trim(),
checkInterval: parseInt(checkIntervalSelect.value),
ntfyTopic: ntfyTopicInput.value.trim(),
notifications: notificationsCheckbox.checked
};

localStorage.setItem('socialSearchSettings', JSON.stringify(settings));
showToast('Settings saved successfully');

// Update UI
topicDisplay.textContent = settings.ntfyTopic;
ntfyLink.href = `https://ntfy.sh/${settings.ntfyTopic}`;

// Reset timer
clearInterval(timer);
startTimer();

// If subreddit or flair changed, clear existing posts that don't match new settings
if (oldSettings.subreddit !== settings.subreddit ||
oldSettings.flair !== settings.flair) {
clearPostsThatDontMatchSettings();
}

// Check for posts with new settings
checkForPosts();
}

function updatePlatformUI(platform) {
// Update UI based on selected platform
switch(platform) {
case 'reddit':
document.querySelector('label[for="subreddit"]').textContent = 'Subreddit';
document.querySelector('label[for="flair"]').textContent = 'Filter by Flair';
recommendedSources.querySelector('h2').textContent = 'Popular Subreddits';
chips.forEach(chip => {
chip.textContent = `r/${chip.dataset.source}`;
});
break;
case 'twitter':
document.querySelector('label[for="subreddit"]').textContent = 'Username/Hashtag';
document.querySelector('label[for="flair"]').textContent = 'Keywords';
recommendedSources.querySelector('h2').textContent = 'Popular Twitter Accounts';
chips.forEach(chip => {
chip.textContent = `@${chip.dataset.source}`;
});
break;
case 'facebook':
document.querySelector('label[for="subreddit"]').textContent = 'Page/Group';
document.querySelector('label[for="flair"]').textContent = 'Keywords';
recommendedSources.querySelector('h2').textContent = 'Popular Facebook Pages';
chips.forEach(chip => {
chip.textContent = `${chip.dataset.source}`;
});
break;
}
}

function clearPostsThatDontMatchSettings() {
// Keep only posts that match current settings
if (allPosts.length > 0) {
const filteredPosts = allPosts.filter(post => {
// Keep posts from the current subreddit
if (post.subreddit.toLowerCase() !== settings.subreddit.toLowerCase()) {
return false;
}

// If flair filter is set (and not N/A), check it too
if (settings.flair && settings.flair !== 'N/A') {
return post.flair && post.flair.toLowerCase().includes(settings.flair.toLowerCase());
}

return true;
});

// Update allPosts and localStorage
allPosts = filteredPosts;
localStorage.setItem('cachedPosts', JSON.stringify(allPosts));

// Display the filtered posts
displayPosts(allPosts.slice(0, visiblePostCount));
}
}

function clearPosts() {
allPosts = [];
localStorage.setItem('cachedPosts', JSON.stringify(allPosts));
postsContainer.innerHTML = '';
postsContainer.appendChild(emptyState);
emptyState.style.display = 'block';
showMoreContainer.classList.add('hidden');
}

function startTimer() {
// Calculate next check time
nextCheckTime = new Date();
nextCheckTime.setMinutes(nextCheckTime.getMinutes() + parseInt(settings.checkInterval));

// Update countdown every second
timer = setInterval(updateCountdown, 1000);
updateCountdown();
}

function updateCountdown() {
const now = new Date();
const diffMs = nextCheckTime - now;

if (diffMs <= 0) {
// Time to check for posts
checkForPosts();
return;
}

// Format the remaining time
const minutes = Math.floor(diffMs / 60000);
const seconds = Math.floor((diffMs % 60000) / 1000);
nextCheckSpan.textContent = `Next check in: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
}

function showMorePosts() {
visiblePostCount += 10;
displayPosts(allPosts.slice(0, visiblePostCount));

// Hide "Show More" button if all posts are now visible
if (visiblePostCount >= allPosts.length) {
showMoreContainer.classList.add('hidden');
}
}

async function checkForPosts() {
// Currently only Reddit is implemented
if (currentPlatform !== 'reddit') {
showToast(`${currentPlatform.charAt(0).toUpperCase() + currentPlatform.slice(1)} integration coming soon`, true);
return;
}

// Show checking state
nextCheckSpan.textContent = 'Checking for posts...';
nextCheckSpan.classList.add('pulse');

try {
// Use corsproxy.io as it's more reliable
const redditUrl = `https://www.reddit.com/r/${settings.subreddit}/new.json?limit=25`;
const corsProxy = 'https://corsproxy.io/?';

const response = await fetch(corsProxy + redditUrl);

if (!response.ok) {
throw new Error(`HTTP error! status: ${response.status}`);
}

const data = await response.json();

// Filter posts by flair (if set and not N/A)
let filteredPosts = data.data.children;
if (settings.flair && settings.flair !== 'N/A') {
const flairLower = settings.flair.toLowerCase();
filteredPosts = filteredPosts.filter(post =>
post.data.link_flair_text &&
post.data.link_flair_text.toLowerCase().includes(flairLower)
);
}

// Get saved posts
const savedPosts = JSON.parse(localStorage.getItem('cachedPosts') || '[]');
const savedPostIds = new Set(savedPosts.map(post => post.id));

// Find new posts
const newPosts = filteredPosts.filter(post => !savedPostIds.has(post.data.id));

// Send notifications for new posts
if (newPosts.length > 0 && settings.notifications) {
for (const post of newPosts) {
sendNotification(post.data);
}
}

// Transform new posts to our format
const formattedNewPosts = newPosts.map(post => ({
id: post.data.id,
title: post.data.title,
author: post.data.author,
subreddit: settings.subreddit,
permalink: `https://www.reddit.com${post.data.permalink}`,
created: post.data.created_utc * 1000, // Convert to milliseconds
flair: post.data.link_flair_text || 'N/A',
score: post.data.score || 0,
thumbnail: post.data.thumbnail && post.data.thumbnail !== 'self' ? post.data.thumbnail : null,
platform: 'reddit'
}));

// Combine new posts with saved posts that match current settings
const matchingPosts = savedPosts.filter(post => {
// Match platform
if (post.platform !== currentPlatform) {
return false;
}

// Match subreddit (case insensitive)
if (post.subreddit.toLowerCase() !== settings.subreddit.toLowerCase()) {
return false;
}

// Match flair if specified (and not N/A)
if (settings.flair && settings.flair !== 'N/A') {
return post.flair && post.flair.toLowerCase().includes(settings.flair.toLowerCase());
}

return true;
});

// Combine matching posts with new posts
allPosts = [...formattedNewPosts, ...matchingPosts]
.sort((a, b) => b.created - a.created)
.slice(0, 100); // Keep up to 100 posts in memory

// Save the updated posts
localStorage.setItem('cachedPosts', JSON.stringify(allPosts));

// Display the posts (but only first batch)
displayPosts(allPosts.slice(0, visiblePostCount));

// Show/hide "Show More" button based on post count
showMoreContainer.classList.toggle('hidden', allPosts.length <= visiblePostCount);

// Show success message if new posts were found
if (newPosts.length > 0) {
showToast(`Found ${newPosts.length} new post${newPosts.length > 1 ? 's' : ''}`);
} else {
showToast('No new posts found');
}
} catch (error) {
console.error('Error checking for posts:', error);
showToast(`Error: ${error.message}. Try a different subreddit.`, true);
} finally {
// Reset countdown
nextCheckSpan.classList.remove('pulse');
nextCheckTime = new Date();
nextCheckTime.setMinutes(nextCheckTime.getMinutes() + parseInt(settings.checkInterval));
updateCountdown();
}
}

function displayPosts(posts) {
// Show empty state if no posts
if (posts.length === 0) {
emptyState.style.display = 'block';
showMoreContainer.classList.add('hidden');
return;
}

// Hide empty state and display posts
emptyState.style.display = 'none';

// Clear existing posts
const existingPosts = document.querySelectorAll('.post-card');
existingPosts.forEach(post => post.remove());

// Create and append post elements
posts.forEach(post => {
const postElement = document.createElement('div');
postElement.className = 'post-card rounded';

// Format date
const postDate = new Date(post.created);
const timeAgo = formatTimeAgo(postDate);

if (post.platform === 'reddit') {
// Reddit-style post
postElement.innerHTML = `
<div class="flex">
<!-- Vote arrows (for UI only) -->
<div class="flex flex-col items-center mr-2">
<svg class="w-5 h-5 text-gray-400 hover:text-vote-up cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
</svg>
<span class="text-xs font-medium my-1">${post.score || 0}</span>
<svg class="w-5 h-5 text-gray-400 hover:text-vote-down cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>
</div>

<!-- Main content -->
<div class="flex-1">
${post.thumbnail ? `
<div class="flex">
<div class="flex-1">
<div class="mb-1 text-xs text-gray-500 dark:text-gray-400">
<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 mr-2">
r/${post.subreddit}
</span>
<span>Posted by u/${post.author}</span>
<span class="mx-1">•</span>
<span>${timeAgo}</span>
</div>
<a href="${post.permalink}" target="_blank" rel="noopener noreferrer" class="text-md font-medium hover:underline">
${post.title}
</a>
<div class="mt-1">
<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200">
${post.flair}
</span>
</div>
</div>
<div class="ml-2">
<img src="${post.thumbnail}" alt="Thumbnail" class="w-16 h-16 object-cover rounded">
</div>
</div>
` : `
<div class="mb-1 text-xs text-gray-500 dark:text-gray-400">
<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 mr-2">
r/${post.subreddit}
</span>
<span>Posted by u/${post.author}</span>
<span class="mx-1">•</span>
<span>${timeAgo}</span>
</div>
<a href="${post.permalink}" target="_blank" rel="noopener noreferrer" class="text-md font-medium hover:underline">
${post.title}
</a>
<div class="mt-1">
<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200">
${post.flair}
</span>
</div>
`}
</div>
</div>
`;
} else if (post.platform === 'twitter') {
// Twitter-style post (placeholder for now)
postElement.innerHTML = `
<div class="flex">
<div class="flex-shrink-0 mr-3">
<div class="w-10 h-10 rounded-full bg-blue-400 flex items-center justify-center text-white">
${post.author.charAt(0).toUpperCase()}
</div>
</div>
<div>
<div class="flex items-center mb-1">
<span class="font-bold mr-1">${post.author}</span>
<span class="text-gray-500 dark:text-gray-400">@${post.author}</span>
<span class="mx-1 text-gray-500 dark:text-gray-400">•</span>
<span class="text-gray-500 dark:text-gray-400">${timeAgo}</span>
</div>
<div class="mb-2">${post.title}</div>
${post.thumbnail ? `<img src="${post.thumbnail}" alt="Media" class="rounded-lg w-full max-h-80 object-cover mb-2">` : ''}
<div class="flex justify-between text-gray-500 dark:text-gray-400">
<span>💬</span>
<span>🔄</span>
<span>❤️</span>
<span>📤</span>
</div>
</div>
</div>
`;
} else if (post.platform === 'facebook') {
// Facebook-style post (placeholder for now)
postElement.innerHTML = `
<div>
<div class="flex items-center mb-3">
<div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white mr-3">
${post.author.charAt(0).toUpperCase()}
</div>
<div>
<div class="font-bold">${post.author}</div>
<div class="text-xs text-gray-500 dark:text-gray-400">${timeAgo}</div>
</div>
</div>
<div class="mb-3">${post.title}</div>
${post.thumbnail ? `<img src="${post.thumbnail}" alt="Media" class="rounded-lg w-full max-h-80 object-cover mb-3">` : ''}
<div class="flex justify-between border-t border-b py-2 border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400">
<span>👍 Like</span>
<span>💬 Comment</span>
<span>📤 Share</span>
</div>
</div>
`;
}

postsContainer.appendChild(postElement);
});
}

function formatTimeAgo(date) {
const seconds = Math.floor((new Date() - date) / 1000);

let interval = Math.floor(seconds / 31536000);
if (interval > 1) return interval + ' years ago';
if (interval === 1) return '1 year ago';

interval = Math.floor(seconds / 2592000);
if (interval > 1) return interval + ' months ago';
if (interval === 1) return '1 month ago';

interval = Math.floor(seconds / 86400);
if (interval > 1) return interval + ' days ago';
if (interval === 1) return '1 day ago';

interval = Math.floor(seconds / 3600);
if (interval > 1) return interval + ' hours ago';
if (interval === 1) return '1 hour ago';

interval = Math.floor(seconds / 60);
if (interval > 1) return interval + ' minutes ago';
if (interval === 1) return '1 minute ago';

return 'just now';
}

async function sendNotification(post) {
try {
const platformName = currentPlatform.charAt(0).toUpperCase() + currentPlatform.slice(1);

// Send notification using ntfy.sh
const message = `New ${platformName} Post: ${post.title}`;
const topic = settings.ntfyTopic;

await fetch(`https://ntfy.sh/${topic}`, {
method: 'POST',
body: message,
headers: {
'Title': `${platformName} Alert`,
'Tags': currentPlatform === 'reddit' ? 'reddit' :
currentPlatform === 'twitter' ? 'bird' :
'bell',
'Priority': '3',
'Click': post.permalink || ''
}
});

console.log('Notification sent for:', post.title);
} catch (error) {
console.error('Error sending notification:', error);
}
}

function copyTopic() {
navigator.clipboard.writeText(settings.ntfyTopic)
.then(() => {
showToast('Topic copied to clipboard');
})
.catch(err => {
console.error('Error copying topic:', err);
showToast('Failed to copy topic', true);
});
}

function showToast(message, isError = false) {
const toast = document.getElementById('toast');
const toastMessage = document.getElementById('toast-message');

toastMessage.textContent = message;
toast.className = isError ? 'fixed right-4 bottom-4 z-50 fadeIn bg-red-500' : 'fixed right-4 bottom-4 z-50 fadeIn';
toast.style.display = 'block';

setTimeout(() => {
toast.className = 'fixed right-4 bottom-4 z-50 fadeOut';
setTimeout(() => {
toast.style.display = 'none';
}, 300);
}, 3000);
}

function initializeTheme() {
// Check for saved theme preference or use system preference
const savedTheme = localStorage.getItem('color-theme');
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
document.documentElement.classList.add('dark');
darkIcon.classList.add('hidden');
lightIcon.classList.remove('hidden');
} else {
document.documentElement.classList.remove('dark');
darkIcon.classList.remove('hidden');
lightIcon.classList.add('hidden');
}
}

function toggleTheme() {
// Toggle dark class on html element
document.documentElement.classList.toggle('dark');

// Update theme in localStorage
if (document.documentElement.classList.contains('dark')) {
localStorage.setItem('color-theme', 'dark');
darkIcon.classList.add('hidden');
lightIcon.classList.remove('hidden');
} else {
localStorage.setItem('color-theme', 'light');
darkIcon.classList.remove('hidden');
lightIcon.classList.add('hidden');
}
}
});
</script>
</body>
</html>
